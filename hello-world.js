var maxLevel = 10;

var level1=new Array(); // regular array (add an optional integer
//objeto
level1[0]=1;//required
level1[1]=0;//another data


level1[2]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level1[3]= 100; //posicion x
level1[4]= 100; //posicion y

level1[5]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level1[6]= 120; //posicion x
level1[7]= 120; //posicion y

/*level1[8]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level1[9]= 150; //posicion x
level1[10]= 150; //posicion y*/

//objeto
var level2=new Array(); // regular array (add an optional integer
level2[0]=5;//required
level2[1]=0;//another data


level2[2]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level2[3]= 70; //posicion x
level2[4]= 70; //posicion y

level2[5]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level2[6]= 190; //posicion x
level2[7]= 190; //posicion y

level2[8]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level2[9]= 70; //posicion x
level2[10]= 190; //posicion y

level2[11]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level2[12]= 190; //posicion x
level2[13]= 70; //posicion y

level2[14]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level2[15]= 120; //posicion x
level2[16]= 120; //posicion y

//objeto
var level3=new Array(); // regular array (add an optional integer
level3[0]=5;//required
level3[1]=0;//another data


level3[2]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level3[3]= 120+12; //posicion x
level3[4]= 120; //posicion y

level3[5]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level3[6]= 120-12; //posicion x
level3[7]= 120; //posicion y

level3[8]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level3[9]= 120; //posicion x
level3[10]= 120+12; //posicion y

level3[11]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level3[12]= 120; //posicion x
level3[13]= 120-12; //posicion y

level3[14]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level3[15]= 120; //posicion x
level3[16]= 120; //posicion y

//objeto
var level4=new Array(); // regular array (add an optional integer
level4[0]=8;//required
level4[1]=0;//another data


level4[2]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level4[3]= 190; //posicion x
level4[4]= 190; //posicion y

level4[5]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level4[6]= 120; //posicion x
level4[7]= 120; //posicion y

level4[8]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level4[9]= 70; //posicion x
level4[10]= 70; //posicion y

level4[11]= 1;//tipo 0 = alien, 1 = zombie, 2 = base
level4[12]= 180; //posicion x
level4[13]= 180; //posicion y

//objeto
var level5=new Array(); // regular array (add an optional integer
level5[0]=10;//required
level5[1]=0;//another data


level5[2]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level5[3]= 120; //posicion x
level5[4]= 120; //posicion y

var level6=new Array(); // regular array (add an optional integer
level6[0]=10;//required
level6[1]=0;//another data


level6[2]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level6[3]= 120; //posicion x
level6[4]= 120; //posicion y

level6[5]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level6[6]= 90; //posicion x
level6[7]= 90; //posicion y

var level7=new Array(); // regular array (add an optional integer
level7[0]=12;//required
level7[1]=0;//another data


level7[2]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level7[3]= 120; //posicion x
level7[4]= 120; //posicion y

level7[5]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level7[6]= 90; //posicion x
level7[7]= 90; //posicion y

level7[8]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level7[9]= 160; //posicion x
level7[10]= 160; //posicion y

//objeto
var level8=new Array(); // regular array (add an optional integer
level8[0]=15;//required
level8[1]=0;//another data


level8[2]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[3]= 120; //posicion x
level8[4]= 120; //posicion y

level8[5]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[6]= 120+12; //posicion x
level8[7]= 120; //posicion y

level8[8]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[9]= 120-12; //posicion x
level8[10]= 120; //posicion y

level8[11]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[12]= 120-12; //posicion x
level8[13]= 120+12; //posicion y

level8[14]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[15]= 120+12; //posicion x
level8[16]= 120+12; //posicion y

level8[17]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[18]= 120+12; //posicion x
level8[19]= 120-12; //posicion y

level8[20]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[21]= 120-12; //posicion x
level8[22]= 120-12; //posicion y

level8[23]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[24]= 120; //posicion x
level8[25]= 120-12; //posicion y

level8[26]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[27]= 120; //posicion x
level8[28]= 120+12; //posicion y

level8[29]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[30]= 120+12+12; //posicion x
level8[31]= 120; //posicion y

level8[32]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[33]= 120-12-12; //posicion x
level8[34]= 120; //posicion y

level8[35]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[36]= 120-12-12; //posicion x
level8[37]= 120+12+12; //posicion y

level8[38]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[39]= 120+12+12; //posicion x
level8[40]= 120+12+12; //posicion y

level8[41]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[42]= 120+12+12; //posicion x
level8[43]= 120-12-12; //posicion y

level8[44]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[45]= 120-12-12; //posicion x
level8[46]= 120-12-12; //posicion y

level8[47]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[48]= 120; //posicion x
level8[49]= 120-12-12; //posicion y

level8[50]= 0;//tipo 0 = alien, 1 = zombie, 2 = base
level8[51]= 120; //posicion x
level8[52]= 120+12+12; //posicion y

var level9=new Array(); // regular array (add an optional integer
level9[0]=20;//required
level9[1]=0;//another data


level9[2]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level9[3]= 120; //posicion x
level9[4]= 120; //posicion y

level9[5]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level9[6]= 90; //posicion x
level9[7]= 90; //posicion y

level9[8]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level9[9]= 160; //posicion x
level9[10]= 160; //posicion y

var level10=new Array(); // regular array (add an optional integer
level10[0]=25;//required
level10[1]=0;//another data


level10[2]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level10[3]= 120; //posicion x
level10[4]= 120; //posicion y

level10[5]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level10[6]= 90; //posicion x
level10[7]= 90; //posicion y

level10[8]= 2;//tipo 0 = alien, 1 = zombie, 2 = base
level10[9]= 160; //posicion x
level10[10]= 160; //posicion y

G.F.loadMain = function () {
    
    this.AI = G.F.mainAI;

    G.S.viewX = 50; //top left X
    G.S.viewY = 50; //top left y
    G.S.gameState = 0; //0 = menu, 1> <49 = intro, 50 = game
    G.S.actualFrame = 1; //0 = menu, 1> <49 = intro, 50 = game
    G.S.maxFrames = 4; //0 = menu, 1> <49 = intro, 50 = game
    G.S.collObject = 0; //0 = menu, 1> <49 = intro, 50 = game
    G.S.aliensNum = 50;
    G.S.weapon = 2;
    G.S.requiredZombies = 2;
    G.S.highScore = 0;
    G.S.gameLevel = 1;
    G.S.gamestarted = 0;

    G.KB.addKeys('a','s','d');
    G.M.addHook('down', G.F.mouseAI, 'down');
    G.M.addHook('up', G.F.mouseAI, 'up');
    G.setState({ targetCount: 10, targetLetters: ['H','E','L','L','O','W','O','R','L','D'] });
    
    G.makeGob('viewport', G)
     .setVar({x:0, y:0, w:512, h:512})
     .setStyle({backgroundColor:'#000000'})
     .addClass('viewport')
     .turnOn();

    G.makeGob('gameWorld',G.O.viewport)
     .setVar({x:128, y:128, w:256, h:256})
     .addClass('world')
     .turnOff();

    G.makeGob('weaponIcon1',G.O.viewport)
     .setVar({x:192, y:415, w:32, h:32})
     .addClass('wpn1')
     .turnOff();

    G.makeGob('messageBox',G.O.viewport)
     .setVar({x:0, y:512-156, w:512, h:156})
     .setSrc('<div style = "padding-left:50px; padding-top:5px;"><strong>Message from earth</strong></div><div style ="padding:7px; margin-right: 60px;">Hello recruit!<br>Welcome to the ship, are you ready to get started?<br> I will teach you the basics, you are a just few seconds away to get started</div>')
     .addClass('messageBox')
     .turnOn();


    G.makeGob('weaponIcon2',G.O.viewport)
     .setVar({x:242, y:415, w:32, h:32})
     .addClass('wpn2')
     .turnOff();

    G.makeGob('weaponIcon3',G.O.viewport)
     .setVar({x:292, y:415, w:32, h:32})
     .addClass('wpn3')
     .turnOff();

    G.makeGob('weapon1',G.O.viewport)
     .setVar({x:192, y:450, w:32, h:32})
     .addClass('wpnOff')
     .turnOff();

    G.makeGob('weapon2',G.O.viewport)
     .setVar({x:242, y:450, w:32, h:32})
     .addClass('wpnOn')
     .turnOff();

    G.makeGob('weapon3',G.O.viewport)
     .setVar({x:292, y:450, w:32, h:32})
     .addClass('wpnOff')
     .turnOff();

    G.makeGob('laserShoot',G.O.gameWorld)
     .setVar({x:0, y:0, w:12, h:12})
     .addClass('laserShoot_2')
     .turnOff();
   

    G.makeGob('gameTitle',G.O.viewport)
     .setVar({x:90, y:180, w:512, h:300})
     .setSrc('<div style ="font-size:30px;">Conquer Pico Worlds!</div>')
     .setStyle({color:'#FFFFFF'})
     .turnOn();


    G.makeGob('my_stats',G.O.viewport)
     .setVar({x:10, y:27, w:200, h:40})
     .setSrc('<div style ="padding-left:18px;"><strong>1 of 2 required</strong></div>')
     .addClass('my_stats')
     .turnOn();

    G.makeGob('ene_stats',G.O.viewport)
     .setVar({x:10, y:47, w:512, h:40})
     .setSrc('<div style ="padding-left:18px;"><strong>Not cleared</strong></div>')
     .addClass('ene_stats')
     .turnOff();

    G.makeGob('level_stats',G.O.viewport)
     .setVar({x:10, y:67, w:200, h:40})
     .setSrc('<div style ="padding-left:18px;"><strong>Planet: 1</strong></div>')
     .addClass('level_stats')
     .turnOff();

    G.makeGob('reset_Btn',G.O.viewport)
     .setVar({x:350, y:10, w:130, h:32})
     .setSrc('&nbsp;Reset')
     .addClass('reset_Btn')
     .turnOff();

    G.makeGob('instructions',G.O.viewport)
     .setVar({x:10, y:415, w:170, h:200})
    .setSrc('<strong>Click and drag the mouse on the planet to use the laser weapons</strong>')
     .addClass('inst')
     .turnOff();

    G.makeGob('instructions_1',G.O.viewport)
     .setVar({x:182, y:480, w:50, h:50})
    .setSrc('<strong>Key A</strong>')
     .addClass('inst_2')
     .turnOff();

    G.makeGob('instructions_2',G.O.viewport)
     .setVar({x:237, y:480, w:50, h:50})
    .setSrc('<strong>Key S</strong>')
     .addClass('inst')
     .turnOff();

    G.makeGob('instructions_3',G.O.viewport)
     .setVar({x:292, y:480, w:50, h:50})
    .setSrc('<strong>Key D</strong>')
     .addClass('inst_2')
     .turnOff();

    G.makeGob('hs_stats',G.O.viewport)
     .setVar({x:10, y:87, w:180, h:40})
     .setSrc('<div style ="padding-left:18px;"><strong>Score: 0</strong></div>')
     .addClass('hs_stats')
     .turnOff();
     G.O.ene_stats.turnOff();
     G.O.my_stats.turnOff();
     G.O.level_stats.turnOff();
     G.O.hs_stats.turnOff();


     
    for (var i = 0; i < G.S.aliensNum; i++) 
    {
         G.makeGob('alien'+i, G.O.gameWorld)
         .setVar({x:70+(i%5)*28, y:25+Math.floor(i/5)*12, w:9, h:9})
         .addClass('alien1')
         .turnOff().S.walking=0;
         G.O['alien' + i].S.team = 0;

    }

};


    var aliens = 0;
    var zombies = 0;
G.F.updateGameText = function () 
{
    aliens = 0;
    zombies = 0;
    var target;
    for (var i = 0; i < G.S.aliensNum; i++) 
    {

         target = G.O['alien' + i];//.S.team = 0;

         if (target.on == false)
         {
            continue;
         }

         if (target.S.team == 0 || target.S.team == 2)
        {
            aliens++;
        }
        else if (target.S.team == 1)
        {
            zombies++;
        }

    }


     G.O.my_stats.setSrc('<div style ="padding-left:18px;"><strong>'+zombies+' of '+G.S.requiredZombies+' required</strong></div>');
     if (aliens>0)
        G.O.ene_stats.setSrc('<div style ="padding-left:18px;"><strong>Not cleared</strong></div>');
     else
        G.O.ene_stats.setSrc('<div style ="padding-left:18px;"><strong>Cleared</strong></div>');
     G.O.my_stats.draw();
     G.O.ene_stats.draw();

     if (G.S.requiredZombies <= zombies && aliens == 0)
     {
        //alert("Planet cleared, congratulations!");
        G.S.highScore += zombies;
        G.S.gameLevel +=1;
        G.O.level_stats.setSrc('<div style ="padding-left:18px;"><strong>Planet: '+ G.S.gameLevel +'</strong></div>');
        G.O.hs_stats.setSrc('<div style ="padding-left:18px;"><strong>Score: '+ G.S.highScore +'</strong></div>');
        G.O.level_stats.draw();
        G.O.hs_stats.draw();
        G.S.gameState = 1;
         G.O.ene_stats.turnOff();
         G.O.my_stats.turnOff();
         G.O.level_stats.turnOn();
         G.O.hs_stats.turnOn();
        G.O.gameWorld.turnOff();
        G.O.weapon1.turnOff();
        G.O.weapon2.turnOff();
        G.O.weapon3.turnOff();
        G.O.weaponIcon1.turnOff();
        G.O.weaponIcon2.turnOff();
        G.O.weaponIcon3.turnOff();
        G.O.reset_Btn.turnOff();
        G.O.instructions.turnOff();
        G.O.instructions_1.turnOff();
        G.O.instructions_2.turnOff();
        G.O.instructions_3.turnOff();
        //G.O.help.turnOn();
        if (maxLevel < G.S.gameLevel)
        {
            G.S.gameLevel -=1;
            G.O.level_stats.setSrc('<div style ="padding-left:18px;"><strong>Planet: '+ G.S.gameLevel +'</strong></div>');
            G.O.level_stats.draw();
            G.S.gameState = 5;
            //G.O.messageBox.setSrc('<div style = "padding-left:50px; padding-top:5px;"><strong>Message from earth</strong></div><div style ="padding:7px; margin-right: 60px;">Congratulations you have cleared the planet and got the required aliens! <br>Click next to continue! </div>').draw();
            //G.O.messageBox.turnOn();
            G.O.viewport.removeClass('frame0').addClass('frameEnd').draw();
            G.O.viewport.removeClass('game').addClass('frameEnd').draw(); 
        }
        else
        {
            G.O.messageBox.setSrc('<div style = "padding-left:50px; padding-top:5px;"><strong>Message from earth</strong></div><div style ="padding:7px; margin-right: 60px;">Congratulations you have cleared the planet and got the required aliens! <br>Click next to continue! </div>').draw();
            G.O.messageBox.turnOn();
            G.O.viewport.removeClass('game').addClass('frame0').draw(); 
        }

     }
     //G.O.help.setSrc('Converted <strong>'+zombies+'</strong> of 10 required<br>Still have <strong>'+aliens+'</strong> aliens, max '+G.S.aliensNum);
     //G.O.help.draw();
}

// The menu/click functions
G.F.mouseAI = function () {
    if (G.S.gameState == 0)
    {
        if (G.M.wasPressed) //G.M.isPressed is when you want to keep it pressed
        {

            //we are at the menu
            if (G.M.x >= 437 && G.M.x <= 493 &&
            G.M.y >= 427 && G.M.y <= 477)
            {
                //G.O.help.setVar({x: G.M.x, y:G.M.y}).draw();
                //G.O.viewport.swapClass('frame1','viewport').draw();
                G.O.gameTitle.turnOff();
                G.O.messageBox.setSrc('<div style = "padding-left:50px; padding-top:5px;"><strong>Message from earth</strong></div><div style ="padding:7px; margin-right: 60px;">This is a pico planet, the size of one picometre, those red things you see there are what we are looking for! They are great to make nano tech, but we need to conquer them and their planet first</div>').draw();
                G.O.viewport.removeClass('viewport').addClass('frame1').draw();  
                G.S.gameState = 1;
                G.S.actualFrame = 1;
            }
        }
    }
    else if (G.S.gameState == 1)
    {
        if (G.M.wasPressed  || G.S.gamestarted == 2)
        {
            //we are at the menu
            if ((G.M.x >= 437 && G.M.x <= 493 &&
            G.M.y >= 427 && G.M.y <= 477) || G.S.gamestarted == 2)
            {
                if (G.S.actualFrame >= G.S.maxFrames)
                {
                    G.S.gamestarted = 1;
                    G.O.viewport.removeClass('frame'+G.S.actualFrame).addClass('game').draw();  
                    G.S.gameState = 2;
                    //G.O.laserShoot.turnOn();
                     G.O.ene_stats.turnOn();
                     G.O.my_stats.turnOn();
                     G.O.level_stats.turnOn();
                     G.O.hs_stats.turnOn();
                    G.O.gameWorld.turnOn();
                    G.O.weapon1.turnOn();
                    G.O.weapon2.turnOn();
                    G.O.weapon3.turnOn();
                    G.O.weaponIcon1.turnOn();
                    G.O.weaponIcon2.turnOn();
                    G.O.weaponIcon3.turnOn();
                    G.O.reset_Btn.turnOn();
                    G.O.instructions.turnOn();
                    G.O.instructions_1.turnOn();
                    G.O.instructions_2.turnOn();
                    G.O.instructions_3.turnOn();
                    //G.O.help.turnOn();
                    G.O.messageBox.turnOff();
                    
                    G.S.collObject = 0;
                    // we load the level
                    var arr = window['level'+ G.S.gameLevel];
                    //alert(arr);
                    var l = (arr.length -2)/3;
                    //alert (l);
                    G.S.requiredZombies = arr[0];
                    for (var i = 0; i < G.S.aliensNum; i++) 
                    {
                        target=G.O['alien' + i];
                        target.S.team = arr[((i*3))+2];
                        target.x = arr[((i*3)+1)+2];
                        target.y = arr[((i*3)+2)+2];
                        if (target.S.team == 0)
                        {
                            target.swapClass('alienBase','alien1');
                            target.swapClass('zombie1','alien1').draw();
                        }
                        else if (target.S.team == 1)
                        {
                            target.swapClass('alienBase','alien1');
                            target.swapClass('alien1','zombie1').draw();
                        }
                        else if (target.S.team == 2)
                        {
                            target.swapClass('alien1','alienBase');
                            target.swapClass('zombie1','alien1').draw();
                        }
                        target.turnOn();
                        if (i>=l)
                            target.turnOff();
                    }
                    return;
                }
                if (G.S.actualFrame == 1)
                {
                     G.O.ene_stats.turnOn();
                     G.O.my_stats.turnOn();
                     G.O.level_stats.turnOn();
                     G.O.hs_stats.turnOn();
                    G.O.messageBox.setSrc('<div style = "padding-left:50px; padding-top:5px;"><strong>Message from earth</strong></div><div style ="padding:7px; margin-right: 60px;">For each planet we <strong>require</strong> a minimun of aliens to be captured (shown at the top left), when captured they turn blue and stop moving, but if a red alien touches it, it will become red again. You need to kill/capture all red aliens to continue</div>').draw();
                }
                else if (G.S.actualFrame == 2)
                {
                     G.O.ene_stats.turnOff();
                     G.O.my_stats.turnOff();
                     G.O.level_stats.turnOff();
                     G.O.hs_stats.turnOff();
                    G.O.messageBox.setSrc('<div style = "padding-left:50px; padding-top:5px;"><strong>Message from earth</strong></div><div style ="padding:7px; margin-right: 60px;">How you ask? you have to use the capture laser (mouse click), you have 3 lasers, you change them with your keyboard keys:<br><strong>KILL(key A)</strong> Will kill anything, red or blue<br><strong>CAPTURE(Key S)</strong> Will turn red into blue<br><strong>RESET(Key D)</strong> Will turn blue into red</div>').draw();
                }
                else if (G.S.actualFrame == 3)
                {
                    G.O.messageBox.setSrc('<div style = "padding-left:50px; padding-top:5px;"><strong>Message from earth</strong></div><div style ="padding:7px; margin-right: 60px;">The red box you see up there, is an alien base, it will create a new red alien each second, it can be helpfull to get more aliens or dangerous sometimes too, you also need to destroy it in order to go the next planet, can\'t be captured, <strong>GOOD LUCK</strong></div>').draw();
                }
                //G.O.help.setVar({x: G.M.x, y:G.M.y}).draw();
                //G.O.viewport.swapClass('frame1','viewport').draw();
                G.S.actualFrame++;
                G.O.viewport.removeClass('frame'+(G.S.actualFrame-1)).addClass('frame'+G.S.actualFrame).draw();  
            }
        }
    }
    else if (G.S.gameState == 2)
    {
        if (G.M.isPressed)
        {
            //x:350, y:10, w:130, h:32
            if (G.M.x >= 350 && G.M.x <= 350+130 &&
            G.M.y >= 10 && G.M.y <= 10+32)
            {
                G.S.gameState = 1;
                G.S.gamestarted = 2;
                G.O.laserShoot.turnOff();
                return;
            }
            G.O.laserShoot.turnOn();
            G.O.laserShoot.setVar({x: G.M.x-128-(G.O.laserShoot.w/2), y:G.M.y-128-(G.O.laserShoot.h/2)}).draw();
            if (G.F._collidesShoot(G.O.laserShoot,-100,0) || G.F._collidesShoot(G.O.laserShoot,-100,2) || G.F._collidesShoot(G.O.laserShoot,-100,1))
            {

                //alert("KILL");;);
                //G.S.collObject.setVar({x: 0, y:0}).draw();

            }
        }
        else
        {
            G.O.laserShoot.turnOff();
        }
    }
}

//var randomnumber=Math.floor(Math.random()*11)

//otro es a quien va a otro
G.F._attackNearest = function (tar,ival,otro)
{
    var t= -1;
    if (otro != null)
        t = otro;
    var target;
    var distanceMin = 1000;
    var targetBest = 0;
    for (var i = 0; i < G.S.aliensNum; i++) 
    {

        target=G.O['alien' + i]
        if ((t!=-1 && target.S.team != t) || target.on == false)
            continue;

        if (i == ival)
        {
            continue;
        }
        //alert(target.x);
        var dx = (target.x+4) - (tar.x + 4);
        var dy = (target.y+4) - (tar.y + 4);
        var distance = Math.sqrt ( dx * dx + dy * dy );
        if (distance < 40 && distance < distanceMin)
        {
            targetBest = target;
            distanceMin = distance;

        }
    }
    //alert("fin");
    if (distanceMin != 1000)
    {
        G.S.collObject_2 = targetBest;
        return true;
    }
    
    return false;
}

G.F._collidesShoot = function (tar,ival,otro)
{

    var t= -1;
    if (otro != null)
        t = otro;
    var target;
    for (var i = 0; i < G.S.aliensNum; i++) 
    {

        target=G.O['alien' + i]
        if (t!=-1 && target.S.team != t || tar.on == false)
            continue;

        if (i == ival)
        {
            continue;
        }
        else if (tar.checkIntersection(target))
        {
            if (G.S.weapon == 1 && (t == 0 || t == 2 || t == 1))
            {
                G.S.collObject = target;
                G.S.collObject.S.team = 1;
                G.S.collObject.turnOff();
            }
            else if (G.S.weapon == 2 && t == 0)
            {
            G.S.collObject = target;
                G.S.collObject.S.team = 1;
                G.S.collObject.swapClass('alien1','zombie1').draw();
            }
            else if (G.S.weapon == 3 && t == 1)
            {
                G.S.collObject = target;
                G.S.collObject.S.team = 0;
                G.S.collObject.swapClass('zombie1','alien1').draw();
            }
        }
    }
    //alert("fin");
    return false;
}

G.F._collides = function (tar,ival,otro)
{

    var t= -1;
    if (otro != null)
        t = otro;
    var target;
    for (var i = 0; i < G.S.aliensNum; i++) 
    {

        target=G.O['alien' + i]
        if (t!=-1 && target.S.team != t || target.on == false)
            continue;

        if (i == ival)
        {
            continue;
        }
        else if (tar.checkIntersection(target))
        {
            G.S.collObject = target;
            return true;
        }
    }
    //alert("fin");
    return false;
}

G.F._killNearest = function (tar,ival,otro)
{

    var t= -1;
    if (otro != null)
        t = otro;
    var target;
    for (var i = 0; i < G.S.aliensNum; i++) 
    {

        target=G.O['alien' + i]
        if (t!=-1 && target.S.team != t || target.on == false)
            continue;

        if (i == ival)
        {
            continue;
        }        

        //alert(target.x);
        var dx = (target.x+4) - (tar.x + 4);
        var dy = (target.y+4) - (tar.y + 4);
        var distance = Math.sqrt ( dx * dx + dy * dy );
        //alert(distance);
        if (distance < 12)
        {
            target.S.team = 0;
            target.swapClass('zombie1','alien1').draw();
            return true;

        }
    }
    //alert("fin");
    return false;
}

G.F.aliensAI = function ()
{
    var target;
    var walkX= 0;
    var walkY = 0;
    var changeChance = 0;
    for (var i = 0; i < G.S.aliensNum; i++) 
    {
        target=G.O['alien' + i];
        if (target.S.team == 1 || target.S.team == 2 || target.on == false)
            continue;

        G.F._killNearest(target,i,1);

        if (G.F._attackNearest(target,i,1) == false)
        {

            changeChance = Math.floor(Math.random()*101);
            if (changeChance > 90) //change dir
            {
                target.S.walking = Math.floor(Math.random()*4);
            }
            if (target.S.walking == 0)
            {
                walkX = 1;
                walkY = 0;
            }
            else if (target.S.walking == 1)
            {
                walkX = -1;
                walkY = 0;
            }
            else if (target.S.walking == 2)
            {
                walkX = 0;
                walkY = -1;
            }
            else if (target.S.walking == 3)
            {
                walkX = 0;
                walkY = 1;
            }
            //alert(distance);
            //G.Gob.checkCollision(gob)
        }
        else
        {
            walkX = 0;
            walkY = 0;
            changeChance = Math.floor(Math.random()*101);
            if (changeChance <50)
            {
                if (G.S.collObject_2.x < target.x)
                {
                    walkX=-1;
                }
                else if (G.S.collObject_2.x > target.x)
                {
                    walkX =+1;
                }
            }
            if (walkX == 0)
            {
                if (G.S.collObject_2.y < target.y)
                {
                    walkY=-1;
                }
                else if (G.S.collObject_2.y > target.y)
                {
                    walkY =+1;
                }
            }
            if (walkY == 0)
            {
                if (G.S.collObject_2.x < target.x)
                {
                    walkX=-1;
                }
                else if (G.S.collObject_2.x > target.x)
                {
                    walkX =+1;
                }
            }
            //continue;
        }
        var dx = 128 - (target.x+walkX+4);
        var dy = 128 - (target.y+walkY+4);
        var distance = Math.sqrt ( dx * dx + dy * dy );
        target.setVar({x:target.x+walkX, y:target.y+walkY});
        if (distance<120 && G.F._collides(target,i) == false)
        {
            target.draw();
        }
        else
        {
            target.setVar({x:target.x-walkX, y:target.y-walkY});
        }
    }
};

var ts = 0;
G.F.respawnFromBase = function ()
{
    if (ts == 0)
        ts = Math.round((new Date()).getTime());

    var newTime = Math.round((new Date()).getTime());
    //alert(newTime-ts);
    if (newTime-ts > 1000)
    {
        for (var z = 0; z < G.S.aliensNum; z++) 
        {
            target2=G.O['alien' + z];
            if (target2.S.team == 2)
            {
                for (var i = 0; i < G.S.aliensNum; i++) 
                {
                    if (i == z)
                        continue;
                    target=G.O['alien' + i];
                    if (target.on == false)
                    {
                        ts = Math.round((new Date()).getTime());
                        target.S.team = 0;
                        
                        
                        //will try to set a position
                        //TODO: respawn at position (random from myself)
                        //try to move to the right
                        var paso = false
                        target.x = target2.x + target2.w + 1;
                        target.y = target2.y;
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x - target2.w - 1;
                            target.y = target2.y;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x - target2.w - 1;
                            target.y = target2.y - target2.h - 1;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x - target2.w - 1;
                            target.y = target2.y + target2.h + 1;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x - target2.w + 1;
                            target.y = target2.y - target2.h + 1;
                        }
                        else
                        {
                            paso = true;
                        }                        
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x + target2.w + 1;
                            target.y = target2.y + target2.h + 1;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x + target2.w + 1;
                            target.y = target2.y - target2.h - 1;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x;
                            target.y = target2.y + target2.h + 1;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x;
                            target.y = target2.y + target2.h - 1;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            target.x = target2.x;
                            target.y = target2.y - target2.h - 1;
                        }
                        else
                        {
                            paso = true;
                        }
                        if (G.F._collides(target,i) == true)
                        {
                            continue;
                            //target.x = target2.x;
                            //target.y = target2.y - target2.h + 1;
                        }
                        else
                        {
                            paso = true;
                        }


                        if (paso == true)
                        {
                            target.S.team = 0;
                            target.swapClass('alienBase','alien1').draw();
                            target.swapClass('zombie1','alien1').draw();
                            target.turnOn();
                        }
                        break;
                    }
                }
            }
        }
    }
};

G.F.KBD_AI = function () 
{
     
    if (G.S.gameState == 2)
    {
        if (G.KB.keys.A.wasPressed)
        {
            G.S.weapon = 1;
            G.O.laserShoot.removeClass('laserShoot_2');
            G.O.laserShoot.removeClass('laserShoot_3');
            G.O.laserShoot.addClass('laserShoot_1').draw();

            G.O.weapon1.swapClass('wpnOff','wpnOn').draw();
            G.O.weapon2.swapClass('wpnOn','wpnOff').draw();
            G.O.weapon3.swapClass('wpnOn','wpnOff').draw();
        }
        if (G.KB.keys.S.wasPressed)
        {
            G.S.weapon = 2;
            G.O.laserShoot.removeClass('laserShoot_1');
            G.O.laserShoot.removeClass('laserShoot_3');
            G.O.laserShoot.addClass('laserShoot_2').draw();
            G.O.weapon1.swapClass('wpnOn','wpnOff').draw();
            G.O.weapon2.swapClass('wpnOff','wpnOn').draw();
            G.O.weapon3.swapClass('wpnOn','wpnOff').draw();
        }
        if (G.KB.keys.D.wasPressed)
        {
            G.S.weapon = 3;
            G.O.laserShoot.removeClass('laserShoot_2');
            G.O.laserShoot.removeClass('laserShoot_1');
            G.O.laserShoot.addClass('laserShoot_3').draw();
            G.O.weapon1.swapClass('wpnOn','wpnOff').draw();
            G.O.weapon2.swapClass('wpnOn','wpnOff').draw();
            G.O.weapon3.swapClass('wpnOff','wpnOn').draw();
        }
    }
}

G.F.mainAI = function () 
{
    G.F.KBD_AI();
    G.F.mouseAI();
    if (G.S.gameState == 2)
    {
        G.F.respawnFromBase();
        G.F.aliensAI();
        G.F.updateGameText();
    }
   
};

G.makeBlock('main', G.F.loadMain).loadBlock('main');